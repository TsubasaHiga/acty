---
/**
 * astro-imagetoolsのPictureコンポーネントのラッパー
 */

import { astroImageTools, values } from '@const/values'
import { Picture } from 'astro-imagetools/components'

export type SrcsetType = {
  sm?: string
  lg?: string
}

export interface Props {
  lazy?: boolean
  alt: string
  src: string
  srcset: SrcsetType
}
const { lazy = true, alt, src, srcset, ...attr } = Astro.props

// srcsetをartDirectivesの形式に変換
const getArtDirectives = Object.entries(srcset).map(([key, value]) => {
  switch (key) {
    case 'sm':
      return {
        src: value,
        media: `(max-width: ${values.BREAKPOINT}px)`
      }
    case 'lg':
      return {
        src: value,
        media: `(min-width: ${values.BREAKPOINT + 1}px)`
      }
  }
})
---

<Picture
  src={src}
  alt={alt}
  formatOptions={astroImageTools.FORMAT_OPTIONS}
  includeSourceFormat={true}
  artDirectives={getArtDirectives}
  loading={lazy ? 'lazy' : 'eager'}
  placeholder="none"
  {...attr}
/>
