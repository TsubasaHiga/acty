---
/**
 * Local Image Component
 */
import type { HTMLAttributes } from 'astro/types'

import { getImageSize } from '@/utils/getImageSize'
import { getPathFromLocalPublic } from '@/utils/getPathFromLocalPublic'

export interface Props extends HTMLAttributes<'img'> {
  src: string
  height?: number
  width?: number
  alt?: string
  lazy?: boolean
  fetchpriority?: HTMLAttributes<'img'>['fetchpriority']
}
const { src, width: srcWidth, height: srcHeight, alt = '', lazy = true, fetchpriority, ...attr } = Astro.props

// srcの画像サイズを取得
// srcWidthとsrcHeightが指定されている場合はそれを優先
const { width, height } =
  srcWidth && srcHeight ? { width: srcWidth, height: srcHeight } : await getImageSize(getPathFromLocalPublic(src))
---

<img
  src={src}
  alt={alt}
  loading={lazy ? 'lazy' : 'eager'}
  fetchpriority={fetchpriority}
  height={height}
  width={width}
  {...attr}
/>
